<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" >
<head>
	<meta charset="UTF-8">
	<title>たつや学長の誰でも完璧メール</title>
	<script th:src="@{/jquery/jquery-3.5.1.min.js}"></script>
    <!-- Bootstrap CSS-->
	<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
	<!-- for org chart -->
	<link rel="stylesheet" href="css/jquery.orgchart.css" th:href="@{/css/jquery.orgchart.css}">
    <link rel="stylesheet" href="css/style.css" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="css/logictree.css" th:href="@{/css/logictree.css}">
	<!-- <link rel="text/javascript" th:href="@{/bootstrap/js/bootstrap.min.js}"> -->
	<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
	<!-- <link rel="text/javascript" th:href="@{/jquery/jquery-3.5.1.min.js}"> -->
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
</head>
<body>
	<div id="chart-container"></div>
    <script type="text/javascript" src="js/jquery.orgchart.js" th:src="@{/javascript/mindmap/jquery.orgchart.js}"></script>
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
			/**
			 * ロジカルツリー図の作成を行う.
			 * 
			 * @param logicTree ロジックツリー情報
			 */
			const loadJsmind = (logicTree) => {
				/** 課題部分の作成を行う */
				const task = createTask(logicTree)
				/** 子要素(第一,二,三階層)の作成を行う(現状第一のみ) */
				const children = createFirstHierarchy(logicTree.firstHierarchyList)
				/** マインドマップの作成 */
			    const data = {
			    	'name': '課題',
			  	    'title': `${task}`,
			  	    children
			    }
				
			    const oc = $('#chart-container').orgchart({
			        'data' : data,
			        'nodeContent': 'title',
			        'direction': 'l2r',
			        'draggable': true
			    })
			}
		
			/**
			 * 第三階層リストの作成を行う.
			 * 
			 * @param thirdHierarchyList 第三階層リスト
			 * @return 第三階層リスト
			 */
			const createThirdHierarchy = (thirdHierarchyList) => {
				thirdHierarchyList = thirdHierarchyList.filter((thirdHierarchy) => {
					return !!thirdHierarchy.explanation
				})
				const thirdHierarchyListForDisplay = thirdHierarchyList.map((thirdHierarchy) => {
					return {
						"name": "第3階層",
						"title": `${thirdHierarchy.explanation}`
					}
				})
				return thirdHierarchyListForDisplay
			}
			
			/**
			 * 第二階層リストの作成を行う.
			 * 
			 * @param secondHierarchyList 第二階層リスト
			 * @return 第二階層リスト
			 */
			const createSecondHierarchy = (secondHierarchyList) => {
				secondHierarchyList = secondHierarchyList.filter((secondHierarchy) => {
					return !!secondHierarchy.explanation
				})
				const secondHierarchyForDisplay = secondHierarchyList.map((secondHierarchy) => {
						return {
							"name": "第2階層",
							"title": `${secondHierarchy.explanation}`,
						    "children": createThirdHierarchy(secondHierarchy.thirdHierarchyList)
						}						
				})
				return secondHierarchyForDisplay
			}
			
			/**
			 * ロジックツリーの子要素を追加する.
			 *  * 
			 * @param firstHierarchyList 第一階層情報リスト
			 * @return 第一階層情報
			 */
			const createFirstHierarchy = (firstHierarchyList) => {
				/** 第一階層のマインドマップを作成する */
				const firstHierarchyListForDisplay = firstHierarchyList.map((firstHierarchy) => {
					return {"name": `${firstHierarchy.word}`, 
							  "title": `${firstHierarchy.anotherWord}`, 
							  "children": createSecondHierarchy(firstHierarchy.secondHierarchyList)
					}
				});
				return firstHierarchyListForDisplay
			}
			
			/**
			 * ロジックツリー課題部分の作成を行う.
			 * 
			 * @param partnerWants 求めるもの
			 * @param currentState 現状
			 * @param descriptionType 説明文の種類(1=原因,2=方法)
			 * @return 課題情報
			 */
			const createTask = ({ partnerWants, currentState, descriptionType }) => {
				const type = descriptionType === '1' ? `この課題の原因にはどのようなものが考えられるか？` : `この課題を解決するにはどのような方法が考えられるか？` ;
				const taskSentense = `${partnerWants}に対して${currentState}のギャップが課題です。${type}`;
				return taskSentense
			}
			
			/** 入力した第一階層リストの取得 */
			let firstHierarchyList = /*[[ ${logicTree.firstHierarchyList} ]]*/
			
			/** 言い換えがnull以外でない項目のみ表示を行う */
		    firstHierarchyList = firstHierarchyList.filter((firstHierarchy) => {
				return firstHierarchy.anotherWord !== null
			})
		
			/** ロジカルツリーの中身作成 */
			const logicTree = {
				partnerWants : /*[[ 「 + ${logicTree.partnerWants} + 」 ]]*/,
				currentState : /*[[ 「 + ${logicTree.currentState} + 」 ]]*/,
				descriptionType : /*[[ ${logicTree.descriptionType} ]]*/,
				firstHierarchyList
			}	
			loadJsmind(logicTree)	
		/*]]>*/
	</script>
</body>
</html>